@page "/Admin"
@rendermode InteractiveServer
@inject NavigationManager Nav
@using Microsoft.AspNetCore.Identity

<div class="admin-container">

    <h1 class="admin-title">Adminbereich</h1>

    @if (!IsAdmin)
    {
        <div class="admin-card">

            <h3>Login</h3>

            <label for="adminEmail">E-Mail</label>
            <input id="adminEmail" type="email" class="admin-input" @bind="adminEmail" />

            <label for="adminPassword">Passwort</label>
            <input id="adminPassword" type="password" class="admin-input" @bind="adminPassword" />

            @if (!string.IsNullOrEmpty(error))
            {
                <p class="admin-error">@error</p>
            }

            <button class="admin-btn admin-login" @onclick="LoginAdmin">
                Login
            </button>
        </div>
    }
    else
    {
        <div class="admin-card">
            <h3>Admin-Panel</h3>

            <p class="admin-info">Du bist eingeloggt.</p>

            <button class="admin-btn admin-logout" @onclick="LogoutAdmin">
                Logout
            </button>
        </div>
    }
</div>

@code {
    private const string storedAdminEmail = "1234@gmail.com";

    private static readonly PasswordHasher<string> passwordHasher = new();

    // Passwort = abc123 (nur Demo, Hash wird automatisch gesalzen)
    private static readonly string storedAdminPasswordHash =
        passwordHasher.HashPassword(storedAdminEmail, "abc123");

    private string adminEmail;
    private string adminPassword;

    private string error;
    private bool IsAdmin = false;

    private void LoginAdmin()
    {
        if (adminEmail != storedAdminEmail)
        {
            error = "Unbekannter Admin";
            return;
        }

        var result = passwordHasher.VerifyHashedPassword(
            storedAdminEmail,
            storedAdminPasswordHash,
            adminPassword ?? ""
        );

        if (result == PasswordVerificationResult.Success)
        {
            IsAdmin = true;
            error = null;
        }
        else
        {
            error = "Falsches Passwort";
        }
    }

    private void LogoutAdmin()
    {
        IsAdmin = false;
        Nav.NavigateTo("/");
    }
}